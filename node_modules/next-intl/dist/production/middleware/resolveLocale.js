"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@formatjs/intl-localematcher"),t=require("negotiator"),l=require("../shared/constants.js"),o=require("./utils.js");function a(e){return e&&e.__esModule?e:{default:e}}var n=a(t);function c(t,l,o){let a;const c=new n.default({headers:{"accept-language":t.get("accept-language")||void 0}}).languages();try{const t=function(e){return e.slice().sort(((e,t)=>t.length-e.length))}(l);a=e.match(c,t,o)}catch(e){}return a}function i(e,t){if(e.has(l.COOKIE_LOCALE_NAME)){var o;const a=null===(o=e.get(l.COOKIE_LOCALE_NAME))||void 0===o?void 0:o.value;if(a&&t.includes(a))return a}}function r(e,t,l,a){let n,{defaultLocale:r,localeDetection:u,localePrefix:s,locales:d}=e;var f;a&&(n=null===(f=o.getPathnameMatch(a,d,s))||void 0===f?void 0:f.locale);return!n&&u&&l&&(n=i(l,d)),!n&&u&&t&&(n=c(t,d,r)),n||(n=r),n}function u(e,t,l,a){const n=function(e,t){var l;let a=o.getHost(e);if(a=null===(l=a)||void 0===l?void 0:l.replace(/:\d+$/,""),a&&t)return t.find((e=>e.domain===a))}(t,e.domains);if(!n)return{locale:r(e,t,l,a)};let u;if(a){var s;const t=null===(s=o.getPathnameMatch(a,e.locales,e.localePrefix))||void 0===s?void 0:s.locale;if(t){if(!o.isLocaleSupportedOnDomain(t,n))return{locale:t,domain:n};u=t}}if(!u&&e.localeDetection&&l){const t=i(l,e.locales);t&&o.isLocaleSupportedOnDomain(t,n)&&(u=t)}if(!u&&e.localeDetection&&t){const l=c(t,n.locales||e.locales,n.defaultLocale);l&&(u=l)}return u||(u=n.defaultLocale),{locale:u,domain:n}}exports.default=function(e,t,l,o){return e.domains?u(e,t,l,o):{locale:r(e,t,l,o)}},exports.getAcceptLanguageLocale=c;
